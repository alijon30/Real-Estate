import React, { Fragment, useEffect, useState } from 'react';
import { Helmet } from 'react-helmet';
import axios from 'axios';
import House from '../assets/house.jpg';


interface Realtor {
  id: number;
  name: string;
  photo: string; // Assuming this is a URL to the photo
  phone: string;
  email: string;
  description: string;
}


const About = () => {

  const [topSeller, setTopSeller] = useState<Realtor[]>([]);
  const [realtors, setRealtors] = useState<Realtor[]>([]);


  useEffect(() => {
    axios.defaults.headers.common['Content-Type'] = 'application/json';

    const getTopSeller = async () => {
      try{
        const res = await axios.get('http://localhost:8001/api/realtors/topseller');
        setTopSeller(res.data);
      } catch (err){

      }
    }
    getTopSeller();
  }, []);

  useEffect(() => {
    axios.defaults.headers.common['Content-Type'] = 'application/json';
    const getRealtors = async () => {
      try{
        const res = await axios.get('http://localhost:8001/api/realtors/topseller');
        setRealtors(res.data);
      } catch (err){

      }
    }
    getRealtors();
  }, []);

  const getAllRealtors = (): JSX.Element => {
    const rows: JSX.Element[] = realtors.map((realtor, i) => (
      <div key={realtor.id} className='col-1-of-3'>
        <div className='about__display'>
          <img className='about__display__image' src={realtor.photo} alt="" />
          <h3 className='about__realtor'>{realtor.name}</h3>
          <p className='about__contact'>{realtor.phone}</p>
          <p className='about__contact'>{realtor.email}</p>
          <p className='about__about'>{realtor.description}</p>
        </div>
      </div>
    ));

    // Adjusting to directly return the mapped realtors without additional row division for simplicity
    return <div className='row'>{rows}</div>;
  };

    const getTopSeller = (): JSX.Element => {
      // If you're fetching multiple top sellers
      return (
        <>
          {topSeller.map((seller) => (
            <Fragment key={seller.id}>
              <div className='about__display'>
                <img className='about__display__image' src={seller.photo} alt={seller.name} />
              </div>
              <h3 className='about__topseller'>Top Seller: {seller.name}</h3>
              <p className='about__contact'>{seller.phone}</p>
              <p className='about__contact'>{seller.email}</p>
              <p className='about__about'>{seller.description}</p>
            </Fragment>
          ))}
        </>
      );
    };


  return (
    <main className='about'>
      <Helmet>
        <title>Real Estate - About</title>
        <meta
          name='description'
          content = 'About us'
        />
      </Helmet>
      <header className='about__header'>
        <h1 className='about__heading'>About Real Estate</h1>
      </header>
      <section className='about__info'>
        <div className='row'>
          <div className='col-3-of-4'>
            <h2 className='about__subheading'>We find the perfect home for you</h2>
            <p className='about__paragraph'>

            </p>
            <div className='about__display'>
              <img className='about__display__image' src={House} alt="" />
            </div>
            <p className='about__paragraph'></p>
          </div>
          <div className='col-1-of-4'>
            {getTopSeller()}
          </div>
        </div>
      </section>
      <section className='about__team'>
        <div className='row'>
          <h2 className='about__subheading'>
            Meet our awesome team!
          </h2>
          {getAllRealtors()}
        </div>
      </section>
    </main>
  )
};

export default About;
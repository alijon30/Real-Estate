import React, {useEffect, useState} from 'react';
import { Helmet } from 'react-helmet';
import axios from 'axios';
import { Link, useParams } from 'react-router-dom';

interface Listing{
  title: string;
  photo_main: string;
  city: string;
  state: string;
  zipcode: string;
  home_type: string;
  price: number; // Assuming price is a number
  bedrooms: number; // Assuming bedrooms is a number
  bathrooms: number; // Assuming bathrooms is a number
  sqft: number; // Assuming sqft is a number
  description: string;
  realtor?: string; // Assuming this is an ID or key to fetch realtor details
  [key: string]: any; 
}
interface Realtor {
  name: string;
  photo: string;
  phone: string;
  email: string;
  description: string;
  // Add other fields as necessary
}



interface ListingDetailProps {
  match: {
    params: {
      id: string;
    };
  };
}

const ListingDetail: React.FC = () => {

  const [listing, setListing] = useState<Listing | null>(null);
  const [realtor, setRealtor] = useState<Realtor | null>(null);
  const [price, setPrice] = useState<string | null>(null);
  const { id } = useParams<{ id: string }>();
  const numberWithCommas = (x:string) => {
    return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',');
  }

  useEffect(()=> {
    const config = {
      headers: {
        'Authorization': `Bearer ${localStorage.getItem('token')}`
      }
    };

    axios.get(`http://localhost:8001/api/listings/${id}`, config)
    .then(res => {
      setListing(res.data);
      setPrice(numberWithCommas(res.data.price))
    })
    .catch(err=> {

    });

  }, [id])

  useEffect(()=> {
    const realtorId = listing?.realtor;
    const config = {
      headers: {
        'Authorization': `Bearer ${localStorage.getItem('token')}`
      }
    };
    if (id){
      axios.get(`http://localhost:8001/api/realtors/${realtorId}`, config)
      .then(res => {
        setRealtor(res.data);
      })
      .catch(err => {

      });
    }
  }, [listing?.realtor]);

  const displayInteriorImages = () => {
    // Assuming each photo field name follows a predictable pattern (e.g., photo_1, photo_2, etc.)
    // Adjust according to your actual data structure
    const images = [];
    if (listing) {
      for (let i = 1; i <= 10; i++) {
        const photoKey = `photo_${i}` as keyof Listing;
        const photoUrl = listing[photoKey];
        if (photoUrl) {
          images.push(
            <div key={i} className="col-1-of-3">
              <div className="listingdetail__display">
                <img className="listingdetail__display__image" src={photoUrl} alt="" />
              </div>
            </div>
          );
        }
      }
    }
    return <div className="row">{images}</div>;
  };
  return (
    <div className='listingdetail'>
      <Helmet>
        <title>Real Estate - Listing | {`${listing?.title}`}</title>
        <meta name='description' content='Listing detail' />
      </Helmet>
      <div className='listingdetail__header'>
        <h1 className='listingdetail__title'>
          {listing?.title}
        </h1>
        <p className='listingdetail__location'>{listing?.city}, {listing?.state}, {listing?.zipcode}</p>
      </div>
      <div className='row'>
        <div className='listingdetail__breadcrumb'>
          <Link className='listingdetail__breadcrumb__link' to='/'>Home</Link> {listing?.title}
        </div>
      </div>
      <div className='row'>
        <div className='col-3-of-4'>
          <div className='listingdetail__display'>
            <img className='listingdetail__display__image' src={listing?.photo_main} alt=''/>
          </div>
        </div>
        <div className='col-1-of-4'>
          <div className='listingdetail__display'>
            <img className='listingdetail__display__image' src={realtor?.photo} alt=''/>
          </div>
          <h3 className='listingdetail__realtor'>{realtor?.name}</h3>
          <p className='listingdetail__realtor'>{realtor?.phone}</p>
          <p className='listingdetail__realtor'>{realtor?.email}</p>
          <p className='listingdetail__realtor'>{realtor?.description}</p>
        </div>
      </div>
      <div className='row'>
        <div className='col-1-of-2'>
          <ul className='listingdetail__list'>
            <li className='listingdetail__list__item'>Home Type: {listing?.home_type}</li>
            <li className='listingdetail__list__item'>Price: ${price}</li>
            <li className='listingdetail__list__item'>Bedrooms: {listing?.bedrooms}</li>
            <li className='listingdetail__list__item'>Bathrooms: {listing?.bathrooms}</li>
            <li className='listingdetail__list__item'>Square Feet: {listing?.sqft}</li>
          </ul>
        </div>
        <div className='col-1-of-2'>
            <ul className='listingdetail__list'>
              <li className='listingdetail__list__item'>Sale Type: {listing?.sale_type}</li>
              <li className='listingdetail__list__item'>Address: {listing?.address}</li>
              <li className='listingdetail__list__item'>City: {listing?.city}</li>
              <li className='listingdetail__list__item'>State: {listing?.state}</li>
              <li className='listingdetail__list__item'>ZipCode: {listing?.zipcode}</li>
            </ul>
        </div>
      </div>
      <div className='row'>
        <p className='listingdetail__description'>{listing?.description}</p>
      </div>
      {displayInteriorImages()}
    </div>
  )
}

export default ListingDetail